From 79791a9eab854e5daf8c66f02cca5cb4d217c5fe Mon Sep 17 00:00:00 2001
From: Andrea Campanella <andrea@opennetworking.org>
Date: Mon, 7 Oct 2019 21:37:53 +0200
Subject: [PATCH] Enabling multiple code generators

---
 build/licensing/boilerplate.generatego.txt |  2 +-
 build/licensing/boilerplate.py             | 11 +++++++++++
 2 files changed, 12 insertions(+), 1 deletion(-)

diff --git a/build/licensing/boilerplate.generatego.txt b/build/licensing/boilerplate.generatego.txt
index 9f23699..0fe2141 100644
--- a/build/licensing/boilerplate.generatego.txt
+++ b/build/licensing/boilerplate.generatego.txt
@@ -1 +1 @@
-// Code generated by protoc-gen-gogo. DO NOT EDIT.
\ No newline at end of file
+// Code generated by GENERATOR. DO NOT EDIT.
\ No newline at end of file
diff --git a/build/licensing/boilerplate.py b/build/licensing/boilerplate.py
index d136bc3..eb866ac 100755
--- a/build/licensing/boilerplate.py
+++ b/build/licensing/boilerplate.py
@@ -125,6 +125,13 @@ def file_passes(filename, refs, regexs):
             if found != 0:
                 break
 
+    if generated:
+        p = regexs["generator_name"]
+        for i, d in enumerate(data):
+            (data[i], found) = p.subn('GENERATOR', d)
+            if found != 0:
+                break
+
     # if we don't match the reference at this point, fail
     if ref != data:
         print("Header in %s does not match reference, diff:" % filename, file=verbose_out)
@@ -188,6 +195,9 @@ def get_dates():
     years = datetime.datetime.now().year
     return '(%s)' % '|'.join((str(year) for year in range(2014, years+1)))
 
+def get_generator():
+    return re.compile('(?<=\bby\W)\b\w+')
+
 def get_regexs():
     regexs = {}
     # Search for "YEAR" which exists in the boilerplate, but shouldn't in the real thing
@@ -201,6 +211,7 @@ def get_regexs():
     regexs["shebang"] = re.compile(r"^(#!.*\n)\n*", re.MULTILINE)
     # Search for generated files
     regexs["generated"] = re.compile( 'DO NOT EDIT' )
+    regexs["generator_name"] = get_generator()
     return regexs
 
 def main():
-- 
2.14.1

